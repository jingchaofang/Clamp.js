<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="book_intro.css">
    <title>详情页</title>
    <script>
    // rem基准计算和限宽
    (function() {
        function refreshRem() {
            if (document.documentElement.clientWidth >= 1024) {
                document.documentElement.style.fontSize = 30 + 'px';
            } else {
                document.documentElement.style.fontSize = (document.documentElement.clientWidth > 720 ? 720 : document.documentElement.clientWidth) / 18 + "px"
            }
        }
        var tid = null;
        window.addEventListener("resize", function() {
            clearTimeout(tid);
            tid = setTimeout(refreshRem, 0);
        }, false);
        refreshRem();
        // hack系统改变字体大小后的根字体大小
        document.addEventListener("DOMContentLoaded", function() {
            // 计算规则设置的根字体大小
            var setFs = parseFloat(document.documentElement.style.fontSize);
            // 实际渲染后的根字体大小，受手机系统改变字体大小影响
            var actFs = parseFloat(window.getComputedStyle(document.documentElement, null).fontSize);
            if (actFs / setFs !== 1) {
                var scaleFs = setFs / (actFs / setFs);
                //console.log("setFs:"+setFs+";actFs:"+actFs+";scaleFs:"+scaleFs);
                // console.log("scale:" + (actFs/setFs));
                document.documentElement.style.fontSize = scaleFs + "px";
            }
        }, false);
    })(window);
    </script>
</head>

<body>
    <!-- 书籍门面 -->
    <div class="face flex">
        <div class="face-cover">
            <img class="face-cover-img" src="http://book.img.ireader.com/idc_1/m_1,w_200,h_266/4e0de3b1/group6/M00/37/6C/CmQUN1X3pJWEYx6BAAAAALwf2UU869059644.jpg?v=qYbPcL8q">
        </div>
        <div class="face-info flex-item">
            <p class="face-info-title">一念天堂，一念地狱一念天堂，一念地狱一念天堂，一念地狱一念天堂，一念地狱一念天堂，一念地狱</p>
            <div class="face-info-score">
                <div class="star-wrap">
                    <div class="score-star-dark"></div>
                    <div class="score-star-bright star9"></div>
                </div>
                <span class="score-num">8.6</span>
                <span class="score-line"></span>
                <span class="score-people">3884人评</span>
            </div>
            <div class="face-info-author flex" data-js="limit">
                <div class="flex-item">
                    <span>这是个为了测试超长作者名的，这是个为了测试超长作者名的</span>
                    <span>dfd </span>
                </div>
                <div class="author-triangle">
                    <div class="triangle"></div>
                </div>
            </div>
            <div class="face-info-sale">
                <div class="strickout">
                    <span class="sale-original-price">500阅饼/千字</span>
                </div>
                <span class="sale-current-price">免费</span>
                <span class="sale-status vip-area">VIP8折</span>
            </div>
            <div class="face-info-discount" data-js="limit-time">限时特价:
                <span data-js="timebegin" data-time="1487606400">剩余
                <span class="num"></span><span class="num"></span>天
                <span class="num"></span><span class="num"></span>小时
                <span class="num"></span><span class="num"></span>分
                <span class="num"></span><span class="num"></span>秒
                </span>
            </div>
        </div>
    </div>
    <!-- 书籍交互信息 -->
    <div class="interactive flex">
        <div class="flex-item">
            <p class="like">7232</p>
            <p>点赞</p>
        </div>
        <div class="flex-item">
            <p class="reading">9677</p>
            <p>在读</p>
        </div>
        <div class="flex-item">
            <p class="fans">23W+</p>
            <p>粉丝</p>
        </div>
    </div>
    <!-- 书籍内容简介和标签 -->
    <div class="content">
        <div id="intro" class="content-intro">编辑简介：人若真的受伤个人若真的受伤的受伤K编辑简介：人若真的受伤个人若真的受伤的受伤K
            内容简编辑简介：人若真的受伤个人若真的受伤的受伤Kr编辑简</div>
        <div id="tag" class="content-tag">
            <span>＃村上春树</span>
            <span>＃日本文学</span>
            <span>＃超现实</span>
            <span>＃现代</span>
            <span>＃村上春树</span>
            <span>＃日本文学</span>
            <span>＃超现实</span>
            <span>＃现代</span>
        </div>
    </div>
    <!--  最新章节 -->
    <div class="chapter border-1px flex-v-center">
        <div class="chapter-entrance flex-item">最新章节:第五章</div>
        <div class="chapter-ps">22小时前更新</div>
        <div class="icono-caret-right"></div>
    </div>
    <!--  开通VIP -->
    <div class="vip border-1px flex-v-center">
        <div class="vip-entrance flex-item">开通VIP，免费阅读此书</div>
        <div class="icono-caret-right"></div>
    </div>
    <!-- 图书评价 -->
    <div class="blank"></div>
    <div class="evalution">
        <div class="evalution-header flex-v-center">
            <div class="header-mark"></div>图书评价</div>
        <div class="evalution-body">
            <div class="evalution-item flex">
                <div class="evalution-item-avatar"><img src="http://q.qlogo.cn/qqapp/100467046/BD08459EACFB14B01D6530F2299597BA/40" class="avatar-img"></div>
                <div class="evalution-item-info flex-item border-1px">
                    <div class="evalution-user flex-v-center">
                        <div class="evalution-username flex-item">评论人的昵称</div>
                        <div class="evalution-userdate">2017-02-11</div>
                    </div>
                    <div class="evalution-text">第二个故事感动的体无完肤。那种年轻时的倔强、无法实现的梦想、来自家人的默默支持、心中的悔过与愧疚、直至最后坦然接受命运……当他的梦想以另一种方式被实现时，那份不易让人鼻子一酸。</div>
                    <div class="evalution-interactive flex-end-v-center">
                        <span class="evalution-like">119</span>喜欢
                        <div class="dot"></div><span class="evalution-reply">43</span>回复
                    </div>
                </div>
            </div>
            <div class="evalution-item flex">
                <div class="evalution-item-avatar"><img src="http://q.qlogo.cn/qqapp/100467046/BD08459EACFB14B01D6530F2299597BA/40" class="avatar-img"></div>
                <div class="evalution-item-info flex-item border-1px">
                    <div class="evalution-user flex-v-center">
                        <div class="evalution-username flex-item">评论人的昵称</div>
                        <div class="evalution-userdate">2017-02-11</div>
                    </div>
                    <div class="evalution-text">第二个故事感动的体无完肤。那种年轻时的倔强、无法实现的梦想、来自家人的默默支持、心中的悔过与愧疚、直至最后坦然接受命运……当他的梦想以另一种方式被实现时，那份不易让人鼻子一酸。</div>
                    <div class="evalution-interactive flex-end-v-center">
                        <span class="evalution-like">119</span>喜欢<em class="dot"></em><span class="evalution-reply">43</span>回复
                    </div>
                </div>
            </div>
        </div>
        <div class="evalution-footer border-1px">全部评论&nbsp;65</div>
    </div>
    <div class="blank"></div>
    <!-- 喜欢这本书的人也喜欢 -->
    <div class="recommend">
        <div class="recommend-header flex-v-center">
            <div class="header-mark"></div>喜欢这本书的人也喜欢</div>
        <div class="h-list">
            <div class="h-list-item">
                <div class="h-book-item">
                    <img class="h-book-cover" src="http://book.img.ireader.com/idc_1/m_1,w_200,h_266/a3d0e744/group6/M00/A7/84/CmQUNlgAm0CEbtHAAAAAAHxTdeE761144158.jpg?v=RxFwjrVc">
                    <p class="h-book-title">软件体的生命周期</p>
                </div>
            </div>
            <div class="h-list-item">
                <div class="h-book-item">
                    <img class="h-book-cover" src="http://book.img.ireader.com/idc_1/m_1,w_200,h_266/a3d0e744/group6/M00/A7/84/CmQUNlgAm0CEbtHAAAAAAHxTdeE761144158.jpg?v=RxFwjrVc">
                    <p class="h-book-title">软件体的生命周期</p>
                </div>
            </div>
            <div class="h-list-item">
                <div class="h-book-item">
                    <img class="h-book-cover" src="http://book.img.ireader.com/idc_1/m_1,w_200,h_266/a3d0e744/group6/M00/A7/84/CmQUNlgAm0CEbtHAAAAAAHxTdeE761144158.jpg?v=RxFwjrVc">
                    <p class="h-book-title">软件体的生命周期</p>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="load-failure">加载失败？请点击重试</div>
        <div class="load-failure">加载失败？请点击重试</div>
    </div>
    <!-- 图书更多信息 -->
    <div class="blank"></div>
    <div class="more">
        <div class="more-header flex-v-center">图书更多信息</div>
        <div class="more-body">
            <p class="more-item">字数：16.4万字</p>
            <p class="more-item">大小：3.19MB</p>
            <p class="more-item">上架：2016-05-24</p>
            <p class="more-item">出版：新经典文化出版社</p>
            <p class="more-item">书号：968-5-2468-0952-4</p>
            <p class="more-item">字数:16.4万字</p>
            <p class="disclaimer">免责声明：
                <br>本书数字版权由上海读客（出版）提供，并由其授权掌阅科技股份有限公司制作发行，若书中含有不良信息，请书友积极告知客服。
            </p>
        </div>
    </div>
    <!-- 低栏 -->
    <div class="bottom-bar flex border-1px">
        <!-- 相应状态class名还有down、wholedown-->
        <div class="shelf">加入书架</div>
        <div class="read flex-item">免费阅读</div>
        <div class="discount">优惠阅读</div>
    </div>
    <style>
    /*添加样式*/
    #intro {
        height: 78px;
    }
    .unclamp {
        height: auto!important
    }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
    <script src="../clamp.js"></script>
    <script>
    $(function() {
        // 书籍简介展开收起
        var $paragraph = $('#intro');
        var clampResult = $clamp($paragraph.get(0), {
            clamp: 3,
            useNativeClamp: false,
            animate: false,
            hasHeight: true,
            truncationHTML: '...<div class="triangle-wrap flex-all-center"><div class="triangle-down"></div></div>'
        });

        var tagWrapWidth = $('#tag').width();
        var $tagArray = $('#tag > span');
        var tagNum = $tagArray.length;
        var tagTotalWidth = 0;
        var tagMarginRight;
        tagNum !== 0 ? tagMarginRight = parseInt(window.getComputedStyle($tagArray.get(0)).getPropertyValue('margin-right')) : 0;
        for (var i = 0; i <= tagNum; i++) {
            tagTotalWidth += $tagArray.eq(i).width() + tagMarginRight;
        }
        if (clampResult.clamped === clampResult.original) {
            if (tagWrapWidth > 0 && tagTotalWidth > tagWrapWidth) {
                $paragraph.append('<div class="triangle-wrap flex-all-center"><div class="triangle-down"></div></div>');
            }
        }
        $paragraph.on('click', function() {
            if (clampResult.clamped !== clampResult.original || (tagWrapWidth > 0 && tagTotalWidth > tagWrapWidth)) {
                $(this).toggleClass('unclamp');

                if ($(this).hasClass('unclamp')) {
                    $paragraph.html(clampResult.original + '<div class="triangle-wrap flex-all-center"><div class="triangle-up"></div></div>');
                } else {
                    if (clampResult.clamped === clampResult.original) {
                        $paragraph.html(clampResult.clamped + '<div class="triangle-wrap flex-all-center"><div class="triangle-down"></div></div>');
                    } else {
                        $paragraph.html(clampResult.clamped);
                    }
                }
            }
            // console.log(tagWrapWidth);
            // console.log(tagTotalWidth);
            // 标签折行时
            if (tagWrapWidth > 0 && tagTotalWidth > tagWrapWidth) {
                $('#tag').toggleClass('height-auto');
            }
        });
    });
    $(function() {
        // 作者名展开收起
        var $authorText = $('[data-js="limit"]');
        var $authorTriangle = $('.author-triangle');
        if ($authorText[0].offsetHeight < $authorText[0].scrollHeight) {
            $authorTriangle.show();
            var $triangleE = $authorTriangle.find('.triangle');
            $authorTriangle.on('click', function() {
                $triangleE.addClass('unclamp').hide();
                $authorText.addClass('height-auto');
            });
        }

    });
    </script>
</body>

</html>